<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Aetheris Nexus OS</title>
    <style>
        :root {
            --accent: var(--tg-theme-button-color, #00d2ff);
            --bg: var(--tg-theme-bg-color, #050505);
            --text: var(--tg-theme-text-color, #ffffff);
            --sec-bg: var(--tg-theme-secondary-bg-color, #1a1a1a);
            --border: rgba(0, 210, 255, 0.2);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding-bottom: 100px; overflow-x: hidden;
        }
        /* Анимация частиц на фоне */
        #particles-js { position: fixed; width: 100%; height: 100%; z-index: -1; opacity: 0.3; }
        
       .header { padding: 30px 20px; text-align: center; background: linear-gradient(to bottom, var(--sec-bg), transparent); }
       .header h1 { margin: 0; font-size: 1.8rem; letter-spacing: 4px; color: var(--accent); text-shadow: 0 0 20px var(--accent); }
        
        /* Навигация */
       .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; background: var(--sec-bg); sticky: top; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
       .nav-item { padding: 15px 5px; text-align: center; font-size: 0.7rem; font-weight: bold; color: #888; cursor: pointer; transition: 0.3s; }
       .nav-item.active { color: var(--accent); border-bottom: 2px solid var(--accent); background: rgba(0, 210, 255, 0.05); }

       .view { display: none; padding: 20px; animation: slideIn 0.4s ease; }
       .view.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

        /* Карточки */
       .card { background: var(--sec-bg); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 15px; position: relative; overflow: hidden; }
       .card h3 { margin: 0 0 10px 0; font-size: 1.1rem; color: var(--accent); }
       .card p { margin: 0; font-size: 0.85rem; opacity: 0.8; line-height: 1.5; }

        /* Прогресс-бары */
       .progress-container { background: #000; height: 8px; border-radius: 4px; margin: 15px 0; overflow: hidden; }
       .progress-bar { background: var(--accent); height: 100%; width: 0%; transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        /* Сетка магазина */
       .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
       .shop-item { background: var(--sec-bg); border-radius: 12px; padding: 15px; text-align: center; border: 1px solid transparent; transition: 0.3s; }
       .shop-item.selected { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }
       .price-tag { display: block; margin-top: 10px; font-weight: bold; color: var(--accent); }

        /* Кнопки действий */
       .btn-main { width: 100%; padding: 14px; border: none; border-radius: 10px; background: var(--accent); color: #000; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 10px; }
       .btn-main:active { transform: scale(0.96); }

        /* Терминал */
       .terminal { background: #000; color: #0f0; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.8rem; height: 150px; overflow-y: auto; border: 1px solid #0f0; }

       .footer { position: fixed; bottom: 0; width: 100%; padding: 15px 20px; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
       .balance { font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="header">
        <h1 id="main-title">AETHERIS NEXUS</h1>
        <p id="user-status" style="font-size: 0.8rem; opacity: 0.6; margin-top: 5px;">Инициализация...</p>
    </div>

    <div class="nav-grid">
        <div class="nav-item active" onclick="showView('dash')">ОБЗОР</div>
        <div class="nav-item" onclick="showView('shop')">МАРКЕТ</div>
        <div class="nav-item" onclick="showView('map')">СЕКТОРЫ</div>
        <div class="nav-item" onclick="showView('inv')">СКЛАД</div>
        <div class="nav-item" onclick="showView('term')">ЛОГИ</div>
        <div class="nav-item" onclick="showView('sets')">ОС</div>
    </div>

    <div id="dash" class="view active">
        <div class="card">
            <h3>Уровень Синхронизации</h3>
            <div class="progress-container"><div class="progress-bar" style="width: 65%"></div></div>
            <p>Статус: Командор. До следующего ранга: 1,400 XP</p>
        </div>
        <div class="card">
            <h3>Активные процессы</h3>
            <p>• Сканирование аномалий в секторе 4... [OK]</p>
            <p>• Сборка нанитов в лабе... [45%]</p>
        </div>
        <button class="btn-main" onclick="tgAction('Daily Reward', 'Bonus Collected')">ПОЛУЧИТЬ ЕЖЕДНЕВНЫЙ БОНУС</button>
    </div>

    <div id="shop" class="view">
        <div class="shop-grid">
            <div class="shop-item" onclick="selectItem(this, 'Ядро ИИ', 500)">
                <h3>Ядро ИИ</h3>
                <span class="price-tag">500 ⚡</span>
            </div>
            <div class="shop-item" onclick="selectItem(this, 'Щит Пустоты', 1200)">
                <h3>Щит Пустоты</h3>
                <span class="price-tag">1200 ⚡</span>
            </div>
            <div class="shop-item" onclick="selectItem(this, 'Разлом', 3000)">
                <h3>Разлом</h3>
                <span class="price-tag">3000 ⚡</span>
            </div>
            <div class="shop-item" onclick="selectItem(this, 'Дрон-разведчик', 800)">
                <h3>Дрон</h3>
                <span class="price-tag">800 ⚡</span>
            </div>
        </div>
    </div>

    <div id="map" class="view">
        <div class="card" onclick="tgAction('Warp', 'Mars Outpost')">
            <h3>Аванпост Марс</h3>
            <p>Сложность: Низкая. Шанс добычи: 15%</p>
            <button class="btn-main" style="background: transparent; color: var(--accent); border: 1px solid var(--accent);">ПРЫЖОК</button>
        </div>
        <div class="card" onclick="tgAction('Warp', 'Black Hole Edge')">
            <h3>Край Черной Дыры</h3>
            <p>Сложность: ЭКСТРЕМАЛЬНАЯ. Шанс добычи: 85%</p>
            <button class="btn-main">НАЧАТЬ ЭКСПЕДИЦИЮ</button>
        </div>
    </div>

    <div id="term" class="view">
        <div class="terminal" id="term-out">
            > Initializing Aetheris Kernel...<br>
            > Checking secure protocols...<br>
            > Nexus Link: STABLE.<br>
        </div>
        <button class="btn-main" onclick="runDiagnostic()">ЗАПУСТИТЬ ДИАГНОСТИКУ</button>
    </div>

    <div class="footer">
        <div class="balance">Энергия: <span id="balance-val">2,450</span> ⚡</div>
        <div style="font-size: 0.7rem; opacity: 0.5;">v4.0.1-STABLE</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // Данные пользователя
        if(tg.initDataUnsafe.user) {
            document.getElementById('user-status').innerText = `Сессия: ${tg.initDataUnsafe.user.username} | ID: ${tg.initDataUnsafe.user.id}`;
        }

        function showView(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        let selected = null;
        function selectItem(el, name, price) {
            document.querySelectorAll('.shop-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            selected = { name, price };
            
            tg.MainButton.setText(`КУПИТЬ: ${name} (${price} ⚡)`);
            tg.MainButton.show();
            tg.MainButton.setParams({ color: "#00d2ff", text_color: "#000000" });
        }

        tg.MainButton.onClick(() => {
            if(selected) {
                tgAction('Purchase', selected.name);
                tg.MainButton.hide();
            }
        });

        function tgAction(type, target) {
            tg.HapticFeedback.notificationOccurred('success');
            const data = {
                op: type,
                val: target,
                ts: Date.now(),
                ver: '4.0'
            };
            tg.sendData(JSON.stringify(data));
        }

        function runDiagnostic() {
            const out = document.getElementById('term-out');
            const msgs = [
                "> Checking memory sectors...",
                "> CPU load: 12% [OK]",
                "> Network latency: 45ms",
                "> Integrity: 100%",
                "> Ready for commands."
            ];
            let i = 0;
            const timer = setInterval(() => {
                out.innerHTML += msgs[i] + "<br>";
                out.scrollTop = out.scrollHeight;
                i++;
                if(i >= msgs.length) clearInterval(timer);
            }, 500);
        }
    </script>
</body>
</html>
