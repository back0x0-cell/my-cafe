<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Mini App Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* =========================================
           CSS STYLES (–û–§–û–†–ú–õ–ï–ù–ò–ï)
           =========================================
        */
        :root {
            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤ –∏–∑ —Ç–µ–º—ã Telegram */
            --tg-bg: var(--tg-theme-bg-color, #fff);
            --tg-text: var(--tg-theme-text-color, #000);
            --tg-hint: var(--tg-theme-hint-color, #999);
            --tg-link: var(--tg-theme-link-color, #2481cc);
            --tg-btn: var(--tg-theme-button-color, #2481cc);
            --tg-btn-text: var(--tg-theme-button-text-color, #fff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #efeff3);
            
            /* –°–≤–æ–∏ —Ü–≤–µ—Ç–∞ */
            --orange: #ff9f0a;
            --green: #30d158;
            --red: #ff453a;
            --card-radius: 14px;
            --anim-speed: 0.25s;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-bg);
            color: var(--tg-text);
            user-select: none; /* –ó–∞–ø—Ä–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ */
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –ó–ê–ì–†–£–ó–ß–ò–ö (PRELOADER) --- */
        #loader {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--tg-bg);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--tg-secondary-bg);
            border-top: 4px solid var(--tg-btn);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            padding: 10px 16px;
            position: sticky;
            top: 0;
            background: var(--tg-bg);
            z-index: 100;
            box-shadow: 0 1px 0 rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .logo {
            font-size: 20px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .user-balance {
            font-size: 14px;
            font-weight: 600;
            color: var(--tg-hint);
            background: var(--tg-secondary-bg);
            padding: 4px 10px;
            border-radius: 8px;
        }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø (–ö–ê–¢–ï–ì–û–†–ò–ò) --- */
        .tabs-container {
            padding: 10px 0;
            background: var(--tg-bg);
            position: sticky;
            top: 50px; /* –í—ã—Å–æ—Ç–∞ —Ö–µ–¥–µ—Ä–∞ */
            z-index: 99;
            overflow-x: auto;
            white-space: nowrap;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        
        .tabs-inner {
            padding: 0 16px;
            display: flex;
            gap: 10px;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            background-color: var(--tg-secondary-bg);
            color: var(--tg-text);
            border: none;
            transition: all var(--anim-speed);
            cursor: pointer;
        }
        .tab.active {
            background-color: var(--tg-btn);
            color: var(--tg-btn-text);
            transform: scale(1.05);
        }

        /* --- –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í --- */
        .container {
            padding: 16px;
            padding-bottom: 100px; /* –ú–µ—Å—Ç–æ –¥–ª—è MainButton */
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 –∫–æ–ª–æ–Ω–∫–∏ */
            gap: 12px;
        }

        .card {
            background: var(--tg-secondary-bg);
            border-radius: var(--card-radius);
            padding: 10px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: transform 0.1s;
        }
        .card:active { transform: scale(0.97); }

        .card-img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 8px;
            background-color: rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
            line-height: 1.2;
        }
        .card-desc {
            font-size: 11px;
            color: var(--tg-hint);
            margin-bottom: 10px;
            flex-grow: 1; /* –¢–æ–ª–∫–∞–µ—Ç —Ü–µ–Ω—É –≤–Ω–∏–∑ */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .price {
            font-size: 15px;
            font-weight: 800;
        }

        /* --- –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–û–õ–ò–ß–ï–°–¢–í–û–ú --- */
        .btn-add {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--tg-btn);
            color: var(--tg-btn-text);
            border: none;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .counter-wrap {
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            align-items: center;
            background: var(--tg-btn);
            border-radius: 16px;
            height: 32px;
            padding: 0 2px;
        }
        .counter-wrap.show { display: flex; }

        .btn-minus, .btn-plus {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tg-btn-text);
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }
        .count-value {
            color: var(--tg-btn-text);
            font-weight: 700;
            font-size: 14px;
            min-width: 20px;
            text-align: center;
        }

        /* --- –í–°–ü–õ–´–í–ê–Æ–©–ï–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï (TOAST) --- */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
            z-index: 2000;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .toast.visible {
            transform: translateX(-50%) translateY(0);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card { animation: fadeIn 0.4s ease forwards; }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
    </div>

    <div id="toast" class="toast">
        <span>‚úÖ</span> <span id="toast-msg">–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω</span>
    </div>

    <header>
        <div class="logo">üöÄ MarketApp</div>
        <div class="user-balance" id="userName">–ì–æ—Å—Ç—å</div>
    </header>

    <div class="tabs-container">
        <div class="tabs-inner" id="tabsList">
            <button class="tab active" onclick="setCategory('all', this)">–í—Å–µ</button>
            <button class="tab" onclick="setCategory('burgers', this)">–ë—É—Ä–≥–µ—Ä—ã</button>
            <button class="tab" onclick="setCategory('pizza', this)">–ü–∏—Ü—Ü–∞</button>
            <button class="tab" onclick="setCategory('sushi', this)">–°—É—à–∏</button>
            <button class="tab" onclick="setCategory('drinks', this)">–ù–∞–ø–∏—Ç–∫–∏</button>
            <button class="tab" onclick="setCategory('tech', this)">–¢–µ—Ö–Ω–∏–∫–∞</button>
        </div>
    </div>

    <div class="container">
        <div class="grid" id="productsGrid">
            </div>
    </div>

    <script>
        /* =========================================
           JAVASCRIPT LOGIC (–§–£–ù–ö–¶–ò–û–ù–ê–õ)
           =========================================
        */

        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram API
        const tg = window.Telegram.WebApp;
        tg.expand(); // –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∞—Ä–æ–≤
        tg.setHeaderColor(tg.themeParams.bg_color || '#ffffff');
        tg.setBackgroundColor(tg.themeParams.bg_color || '#ffffff');

        // –í—ã–≤–æ–¥ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userEl = document.getElementById('userName');
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            userEl.innerText = tg.initDataUnsafe.user.first_name;
        }

        // 2. –ë–æ–ª—å—à–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (Mock Data)
        const db = [
            // –ë—É—Ä–≥–µ—Ä—ã
            { id: 101, cat: 'burgers', name: '–ß–∏–∑–±—É—Ä–≥–µ—Ä XL', price: 290, desc: '–î–≤–æ–π–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞, —á–µ–¥–¥–µ—Ä, —Å–æ—É—Å', img: 'https://cdn-icons-png.flaticon.com/512/3075/3075977.png' },
            { id: 102, cat: 'burgers', name: '–ë–∏–≥ –¢–µ–π—Å—Ç–∏', price: 350, desc: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–∫—É—Å, —Å–≤–µ–∂–∏–µ –æ–≤–æ—â–∏', img: 'https://cdn-icons-png.flaticon.com/512/877/877951.png' },
            { id: 103, cat: 'burgers', name: '–ß–∏–∫–µ–Ω –ü—Ä–µ–º—å–µ—Ä', price: 270, desc: '–ö—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ –≤ –ø–∞–Ω–∏—Ä–æ–≤–∫–µ', img: 'https://cdn-icons-png.flaticon.com/512/1057/1057356.png' },
            // –ü–∏—Ü—Ü–∞
            { id: 201, cat: 'pizza', name: '–ü–µ–ø–ø–µ—Ä–æ–Ω–∏', price: 590, desc: '–û—Å—Ç—Ä–∞—è –∫–æ–ª–±–∞—Å–∫–∞, –º–æ—Ü–∞—Ä–µ–ª–ª–∞', img: 'https://cdn-icons-png.flaticon.com/512/3132/3132693.png' },
            { id: 202, cat: 'pizza', name: '4 –°—ã—Ä–∞', price: 650, desc: '–ü–∞—Ä–º–µ–∑–∞–Ω, —á–µ–¥–¥–µ—Ä, –¥–æ—Ä–±–ª—é', img: 'https://cdn-icons-png.flaticon.com/512/1404/1404945.png' },
            { id: 203, cat: 'pizza', name: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', price: 450, desc: '–¢–æ–º–∞—Ç—ã, –±–∞–∑–∏–ª–∏–∫, —Å—ã—Ä', img: 'https://cdn-icons-png.flaticon.com/512/3595/3595455.png' },
            { id: 204, cat: 'pizza', name: '–î–∏–∞–±–ª–æ', price: 620, desc: '–û—á–µ–Ω—å –æ—Å—Ç—Ä–∞—è —Å —Ö–∞–ª–∞–ø–µ–Ω—å–æ', img: 'https://cdn-icons-png.flaticon.com/512/6978/6978255.png' },
            // –°—É—à–∏
            { id: 301, cat: 'sushi', name: '–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è', price: 550, desc: '–õ–æ—Å–æ—Å—å, —Å–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä', img: 'https://cdn-icons-png.flaticon.com/512/2252/2252075.png' },
            { id: 302, cat: 'sushi', name: '–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è', price: 490, desc: '–ö—Ä–∞–±, –∞–≤–æ–∫–∞–¥–æ, –∏–∫—Ä–∞', img: 'https://cdn-icons-png.flaticon.com/512/3183/3183424.png' },
            { id: 303, cat: 'sushi', name: '–ú–∞–∫–∏ —Å –æ–≥—É—Ä—Ü–æ–º', price: 190, desc: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ä–æ–ª–ª—ã', img: 'https://cdn-icons-png.flaticon.com/512/1900/1900683.png' },
            // –ù–∞–ø–∏—Ç–∫–∏
            { id: 401, cat: 'drinks', name: '–ö–æ–ª–∞ 0.5', price: 120, desc: '–•–æ–ª–æ–¥–Ω–∞—è –≥–∞–∑–∏—Ä–æ–≤–∫–∞', img: 'https://cdn-icons-png.flaticon.com/512/2405/2405597.png' },
            { id: 402, cat: 'drinks', name: '–ê–º–µ—Ä–∏–∫–∞–Ω–æ', price: 150, desc: '–ì–æ—Ä—è—á–∏–π –∑–µ—Ä–Ω–æ–≤–æ–π –∫–æ—Ñ–µ', img: 'https://cdn-icons-png.flaticon.com/512/924/924514.png' },
            { id: 403, cat: 'drinks', name: '–ú–∏–ª–∫—à–µ–π–∫', price: 250, desc: '–í–∞–Ω–∏–ª—å–Ω—ã–π –≤–∫—É—Å', img: 'https://cdn-icons-png.flaticon.com/512/3081/3081162.png' },
            // –¢–µ—Ö–Ω–∏–∫–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
            { id: 501, cat: 'tech', name: 'AirPods Pro', price: 20000, desc: '–®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ', img: 'https://cdn-icons-png.flaticon.com/512/5906/5906169.png' },
            { id: 502, cat: 'tech', name: 'PowerBank', price: 3000, desc: '10000 mAh', img: 'https://cdn-icons-png.flaticon.com/512/4507/4507563.png' },
        ];

        // 3. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let cart = {}; // –•—Ä–∞–Ω–∏—Ç { id: –∫–æ–ª-–≤–æ }
        let currentCat = 'all';

        // 4. –õ–æ–≥–∏–∫–∞ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        const grid = document.getElementById('productsGrid');

        function render() {
            grid.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            const filtered = currentCat === 'all' 
                ? db 
                : db.filter(item => item.cat === currentCat);

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column: span 2; text-align: center; padding: 20px; color: var(--tg-hint);">–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—É—Å—Ç–æ üòî</div>';
                return;
            }

            filtered.forEach(item => {
                const count = cart[item.id] || 0;
                
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <img src="${item.img}" class="card-img" alt="${item.name}">
                    <div class="card-title">${item.name}</div>
                    <div class="card-desc">${item.desc}</div>
                    <div class="card-bottom">
                        <div class="price">${item.price} ‚ÇΩ</div>
                        
                        <button class="btn-add" id="add-${item.id}" 
                                onclick="addItem(${item.id})" 
                                style="display: ${count > 0 ? 'none' : 'flex'}">
                            +
                        </button>

                        <div class="counter-wrap ${count > 0 ? 'show' : ''}" id="counter-${item.id}">
                            <div class="btn-minus" onclick="minusItem(${item.id})">‚àí</div>
                            <div class="count-value" id="val-${item.id}">${count}</div>
                            <div class="btn-plus" onclick="addItem(${item.id})">+</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 5. –õ–æ–≥–∏–∫–∞ –ö–æ—Ä–∑–∏–Ω—ã
        function addItem(id) {
            // –í–∏–±—Ä–∞—Ü–∏—è (Haptic Feedback)
            tg.HapticFeedback.impactOccurred('medium');

            if (!cart[id]) cart[id] = 0;
            cart[id]++;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –±–µ–∑ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
            updateCardState(id);
            updateMainButton();
            
            if (cart[id] === 1) showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
        }

        function minusItem(id) {
            tg.HapticFeedback.impactOccurred('light');

            if (cart[id]) cart[id]--;
            if (cart[id] <= 0) delete cart[id];

            updateCardState(id);
            updateMainButton();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function updateCardState(id) {
            const count = cart[id] || 0;
            const addBtn = document.getElementById(`add-${id}`);
            const counter = document.getElementById(`counter-${id}`);
            const val = document.getElementById(`val-${id}`);

            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –µ—Å—Ç—å –≤ DOM (–º—ã –≤ –Ω—É–∂–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
            if (addBtn && counter && val) {
                if (count > 0) {
                    addBtn.style.display = 'none';
                    counter.classList.add('show');
                    val.innerText = count;
                } else {
                    addBtn.style.display = 'flex';
                    counter.classList.remove('show');
                }
            }
        }

        // 6. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        window.setCategory = (cat, btnElement) => {
            // –í–∏–±—Ä–∞—Ü–∏—è —Å–º–µ–Ω—ã —Ç–∞–±–æ–≤
            tg.HapticFeedback.selectionChanged();

            currentCat = cat;
            
            // –°–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btnElement.classList.add('active');

            render();
        }

        // 7. Main Button (–ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å–Ω–∏–∑—É)
        function updateMainButton() {
            let totalSum = 0;
            let totalItems = 0;

            // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É
            for (const [id, qty] of Object.entries(cart)) {
                const product = db.find(p => p.id == id);
                if (product) {
                    totalSum += product.price * qty;
                    totalItems += qty;
                }
            }

            if (totalSum > 0) {
                tg.MainButton.setText(`–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑: ${totalSum} ‚ÇΩ`);
                tg.MainButton.show();
                tg.MainButton.enable();
                tg.MainButton.setParams({
                    color: '#2481cc', // –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏
                    text_color: '#ffffff'
                });
            } else {
                tg.MainButton.hide();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ MainButton
        tg.MainButton.onClick(() => {
            // –§–æ—Ä–º–∏—Ä—É–µ–º —á–µ–∫
            let orderList = [];
            let total = 0;

            for (const [id, qty] of Object.entries(cart)) {
                const product = db.find(p => p.id == id);
                if (product) {
                    orderList.push(`${product.name} x${qty} = ${product.price * qty}‚ÇΩ`);
                    total += product.price * qty;
                }
            }

            const dataToSend = {
                order_id: Math.floor(Math.random() * 100000),
                total_price: total,
                items: orderList,
                user: tg.initDataUnsafe.user
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É (–∫–∞–∫ —Å—Ç—Ä–æ–∫—É JSON)
            tg.sendData(JSON.stringify(dataToSend));
        });

        // 8. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.add('visible');
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 2000);
        }

        // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                }, 300);
            }, 800);
            render(); // –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
        };

    </script>
</body>
</html>
